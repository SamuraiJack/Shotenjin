<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html">
  <title>jsTenjin User's Guide</title>
  <meta name="generator" content="kwaser">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <link rel="stylesheet" href="docstyle.css" type="text/css">
 </head>
 <body>

  <blockquote>
   <div class="mainbody">

    <div align="left"><h1>jsTenjin User's Guide</h1></div>
    <div align="left">
      last update: $Date: 2007-08-04 13:23:33 +0900 (Sat, 04 Aug 2007) $<br>
    </div>

<p>Release: 0.0.3
</p>
<p>Table of Contents:
<ul>
  <li><a href="#intro">Introduction</a>
  <ul>
    <li><a href="#overview">Overview</a>
    </li>
    <li><a href="#features">Features</a>
    </li>
    <li><a href="#comparison">Comparison with other solutions</a>
    </li>
    <li><a href="#benchmark">Benchmark</a>
    </li>
  </ul>
  </li>
  <li><a href="#installation">Installation</a>
  </li>
  <li><a href="#desguide">Designer's Guide</a>
  <ul>
    <li><a href="#des-notation">Notation</a>
    </li>
    <li><a href="#des-convert">Convert into JavaScript Code</a>
    </li>
    <li><a href="#des-syntaxchk">Syntax Checking</a>
    </li>
    <li><a href="#des-contextdata">Context Data File</a>
    </li>
    <li><a href="#des-cmlinecontext">Command-line Context Data</a>
    </li>
    <li><a href="#des-nested-template">Nested Template</a>
    </li>
    <li><a href="#des-layout">Layout Template</a>
    </li>
    <li><a href="#des-capturing">Capturing</a>
    </li>
    <li><a href="#des-args">Template Arguments</a>
    </li>
    <li><a href="#des-preprocess">Preprocessing</a>
    </li>
    <li><a href="#des-otheropts">Other Options</a>
    </li>
  </ul>
  </li>
  <li><a href="#devguide">Developer's Guide</a>
  <ul>
    <li><a href="#dev-example">An Example</a>
    </li>
    <li><a href="#dev-classes">Classes and Functions in jsTenjin</a>
    </li>
    <li><a href="#dev-templateclass">Class Tenjin.Template</a>
    </li>
    <li><a href="#dev-engineclass">Class Tenjin.Engine</a>
    </li>
    <li><a href="#dev-initopts">Template Initialize Options</a>
    </li>
    <li><a href="#dev-othertopics">Other Topics</a>
    </li>
  </ul>
  </li>
</ul>
</p>
<a name="intro"></a>
<h2 class="section1">Introduction</h2>
<a name="overview"></a>
<h3 class="section2">Overview</h3>
<p>jsTenjin is a very fast and lightweight template engine based on embedded JavaScript.
You can embed JavaScript statements and expressions into your text file.
jsTenjin converts it into JavaScript script and evaluate it.
</p>
<p>The following is an example of jsTenjin.
</p>
<a name="ex.jshtml"></a>
<div class="program_caption">
File 'ex.jshtml':</div>
<pre class="program">Hello <strong>#{name}</strong>!
&lt;ul&gt;
<strong>&lt;?js for (var i = 0, n = items.length; i &lt; n; i++) { ?&gt;</strong>
 &lt;li&gt;<strong>${items[i]}</strong>&lt;/li&gt;
<strong>&lt;?js } ?&gt;</strong>
&lt;/ul&gt;
</pre>
<p>Here is the notation:
</p>
<ul type="disc">
<li><code>&lt;?js ... ?&gt;</code> represents embedded JavaScript statements.
</li>
<li><code>#{...}</code> represents embedded JavaScript expression.
</li>
<li><code>${...}</code> represents embedded escaped (sanitized) JavaScript expression.
</li>
</ul>
<a name="ex_source.result"></a>
<div class="terminal_caption">
Result of covertion into JavaScript script:</div>
<pre class="terminal">$ jstenjin -s ex.jshtml
var _buf = [];  _buf.push('Hello ', name, '!\n\
&lt;ul&gt;\n');
 for (var i = 0, n = items.length; i &lt; n; i++) {
 _buf.push(' &lt;li&gt;', escapeXml(items[i]), '&lt;/li&gt;\n');
 }
 _buf.push('&lt;/ul&gt;\n');
_buf.join('')
</pre>
<a name="ex.result"></a>
<div class="terminal_caption">
Output of execution with context data:</div>
<pre class="terminal">$ jstenjin -c "name:'World', items:['&lt;AAA&gt;','B&amp;B','\"CCC\"']" ex.jshtml
Hello World!
&lt;ul&gt;
 &lt;li&gt;&amp;lt;AAA&amp;gt;&lt;/li&gt;
 &lt;li&gt;B&amp;amp;B&lt;/li&gt;
 &lt;li&gt;&amp;quot;CCC&amp;quot;&lt;/li&gt;
&lt;/ul&gt;
</pre>
<a name="ex.script"></a>
<div class="program_caption">
Example of JavaScript script</div>
<pre class="program">load('tenjin.js');
var engine = new Tenjin.Engine();
var context = { name:'World', items:['&lt;AAA&gt;', 'B&amp;B', '"CCC"'] };
var output = engine.render('ex.jshtml', context);
print(output);
</pre>
<p>jsTenjin is designed for server-side JavaScript and it may be overspec for client-side JavaScript.
Download files of jsTenjin contains 'shotenjin.js' which is minimun subset of 'tenjin.js' and more suitable for client-side JavaScript.
</p>
<a name="ex.html"></a>
<div class="program_caption">
Example of JavaScript script</div>
<pre class="program">    &lt;script language="JavaScript" type="text/javascript" <strong>src="shotenjin.js"</strong>&gt;&lt;/script&gt;
    &lt;script language="JavaScript" type="text/javascript"&gt;
      &lt;!--

function build_table() {
    var input = '\
&lt;table border="1"&gt;\n\
  &lt;tbody&gt;\n\
    &lt;?js for (var i = 0, n = items.length; i &lt; n; i++) { ?&gt;\n\
    &lt;tr&gt;\n\
      &lt;td&gt;#{i}&lt;/td&gt;\n\
      &lt;td&gt;${items[i]}&lt;/td&gt;\n\
    &lt;/tr&gt;\n\
    &lt;?js } ?&gt;\n\
  &lt;/tbody&gt;\n\
&lt;table&gt;\
';
    var context = {items: ['AAA','BBB','CCC']};
    var output = <strong>Shotenjin.render(input, context)</strong>;
    document.getElementById('targettable').innerHTML = output;
    document.getElementById('htmlsource').innerHTML = escapeXml(output);
}
      --&gt;
    &lt;/script&gt;
    &lt;input type="button" value="Build table" onclick="javascript:build_table()" /&gt;
    &lt;table id="targettable"&gt;&lt;/table&gt;
    &lt;div id="htmlsource"&gt;&lt;/div&gt;
</pre>
<!-- SCRIPT -->
<div>
    <script language="JavaScript" type="text/javascript" src="shotenjin.js"></script>
    <script language="JavaScript" type="text/javascript">
      <!--

function build_table() {
    var input = '\
<table border="1">\n\
  <tbody>\n\
    <?js for (var i = 0, n = items.length; i < n; i++) { ?>\n\
    <tr>\n\
      <td>#{i}</td>\n\
      <td>${items[i]}</td>\n\
    </tr>\n\
    <?js } ?>\n\
  </tbody>\n\
<table>\
';
    var context = {items: ['AAA','BBB','CCC']};
    var output = Shotenjin.render(input, context);
    document.getElementById('targettable').innerHTML = output;
    document.getElementById('htmlsource').innerHTML = escapeXml(output);
}
      -->
    </script>
</div>
<!-- /SCRIPT -->
    <input type="button" value="Build table" onclick="javascript:build_table()" />
    <table id="targettable"></table>
    <span>Source:</span>
    <pre id="htmlsource"></pre>
<br>


<a name="features"></a>
<h3 class="section2">Features</h3>
<p>jsTenjin has the following features:
</p>
<ul type="disc">
<li>jsTenjin runs very fast.
</li>
<li>jsTenjin doesn't break HTML design because it uses XML Processing
  Instructions (PI) as embedded notation for JavaScript statements.
</li>
<li>jsTenjin is secure because it supports escaping expression value by default.
</li>
<li>jsTenjin is small and lightweight. It is very easy to include jsTenjin
  into your application.
</li>
<li>jsTenjin supports auto caching of converted JavaScript code.
</li>
<li>jsTenjin supports partial template and layout template.
  These are very useful especially for web application.
</li>
<li>jsTenjin supports partial capturing of template.
</li>
<li>jsTenjin can load YAML file as context data. Using jsTenjin, it is able to
  separate template file and data file.
</li>
</ul>
<br>


<a name="comparison"></a>
<h3 class="section2">Comparison with other solutions</h3>
<p>jsTenjin has advantages compared with other solutions (including other language solutions):
</p>
<ul type="disc">
<li><strong>Easy to design</strong> --
  JSP, ePerl, or eRuby breaks HTML design because they use
  '<code>&lt;% ... %&gt;</code>' as embedded notation which is not valid in HTML.
  jsTenjin doesn't break HTML desgin because it uses Processing
  Instructions (PI) as embedded notation which is valid in HTML.
</li>
<li><strong>Easy to write</strong> --
  In PHP, it is a little bother to write embedded expression
  because the notation '<code>&lt;?php echo $value; ?&gt;</code>' is a little long,
  and very bother to embed escaped expression because
  '<code>&lt;?php echo htmlspecialchars($value); ?&gt;</code>' is very long.
  In jsTenjin, these are very easy to write because embedded expression
  notations ('<code>#{value}</code>' and '<code>${value}</code>') are very short.
</li>
<li><strong>Easy to learn</strong> --
  Some template systems
  are hard to learn because they are large, highly functinal, and
  based on non-JavaScript syntax.
  jsTenjin is very easy to learn if you already know JavaScript language because
  it is very small and  you can embed any JavaScript code into HTML template.
</li>
</ul>
<br>


<a name="benchmark"></a>
<h3 class="section2">Benchmark</h3>
<p>Benchmark script is contained in jsTenjin archive.
The following is an example of benchmark.
</p>
<div class="terminal_caption">
MacOS X 10.4 Tiger, Intel CoreDuo 1.83GHz, Memory 2GB</div>
<pre class="terminal">$ cd pltenjin-X.X.X/benchmark
$ js -h
JavaScript-C 1.6 pre-release 1 2006-04-04 (OSSP js 1.6.20070208)
usage: js [-PswWxC] [-b branchlimit] [-c stackchunksize] [-v version] [-f script
file] [-e script] [-S maxstacksize] [scriptfile] [scriptarg...]
$ make N=10000 JS=js
time js bench.js -n 10000
        0.01 real         0.01 user         0.00 sys
time js bench.js -n 10000 tenjin-cached
       19.00 real        15.14 user         3.73 sys
time js bench.js -n 10000 tenjin-nocache
       29.78 real        26.74 user         2.92 sys
time js bench.js -n 10000 tenjin-reuse
       12.98 real        12.43 user         0.47 sys

$ java -version
java version "1.5.0_07"
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_07-164)
Java HotSpot(TM) Client VM (build 1.5.0_07-87, mixed mode, sharing)
$ make N=10000 JS='java -server -jar js.jar'
time java -server -jar js.jar bench.js -n 10000
        0.69 real         0.58 user         0.06 sys
time java -server -jar js.jar bench.js -n 10000 tenjin-cached
       24.29 real        23.15 user         1.22 sys
time java -server -jar js.jar bench.js -n 10000 tenjin-nocache
       42.05 real        40.59 user         1.61 sys
time java -server -jar js.jar bench.js -n 10000 tenjin-reuse
       19.15 real        18.59 user         0.42 sys
</pre>
<br>


<br>


<a name="installation"></a>
<h2 class="section1">Installation</h2>
<ol type="1">
<li>Install Rhino or Spidermonkey with File object enabled.
<pre class="terminal">### Rhino
$ wget ftp://ftp.mozilla.org/pub/mozilla.org/js/rhino1_6R5.zip
$ jar xf rhino1_6R5.zip
$ sudo mkdir -p /usr/local/java
$ cp rhino1_6R5/js.jar /usr/local/java
$ java -jar /usr/local/java/js.jar -e 'print(typeof(java))'
object
### Spidermonkey
$ wget ftp://ftp.ossp.org/pkg/lib/js/js-1.6.20070208.tar.gz
$ tar xzf js-1.6.20070208.tar.gz
$ cd js-1.6.*/
$ ./configure --prefix=/usr/local --with-utf8 --with-editline
$ make JS_THREADSAFE=1 JS_HAS_FILE_OBJECT=1
$ sudo make install
$ js -e 'print(typeof(File))'
function
</pre>
</li>
<li>Copy 'lib/tenjin.js' to proper directory.
<pre class="terminal">$ mkdir -p $HOME/lib/js
$ cp lib/tenjin.js $HOME/lib/js
</pre>
</li>
<li>Set '$TENJIN_JS' environment variable or edit 'jstenjin' and set TENJIN_JS variable.
<pre class="terminal">$ export TENJINS_JS=$HOME/lib/js/tenjin.js
## or vi bin/jstenjin
</pre>
</li>
<li>Copy 'jstenjin' to proper directory.
<pre class="terminal">$ mkdir $HOME/bin
$ export PATH=$PATH:$HOME/bin
$ cp bin/jstenjin $HOME/bin/jstenjin
$ chmod 755 $HOME/bin/jstenjin
</pre>
</li>
<li>Edit 'bin/jstenjin' command script and set command path
<pre class="program">#!/usr/local/bin/java -jar /usr/local/java/js.jar -strict     # for Rhino
#!/usr/local/bin/js -s                                        # for Spidermonkey
</pre>
</li>
</ol>
<p>Notice that jstenjin command is written in Ruby. You must install Ruby 1.8 or higher.
</p>
<br>


<a name="desguide"></a>
<h2 class="section1">Designer's Guide</h2>
<p>This section shows how to use jsTenjin for designer.
</p>
<p>If you want to know how to use jsTenjin in your program, see <a href="#devguide">Developer's Guide</a> section.
</p>
<a name="des-notation"></a>
<h3 class="section2">Notation</h3>
<p>The following is the notation of jsTenjin.
</p>
<ul type="disc">
<li>'<code>&lt;?js ... ?&gt;</code>' represents embedded JavaScript statement.
</li>
<li>'<code>#{...}</code>' represents embedded JavaScript expression.
</li>
<li>'<code>${...}</code>' represents embedded JavaScript expression which is to be escaped (for example, '<code>&amp; &lt; &gt; "</code>' is escaped to '<code>&amp;amp; &amp;lt; &amp;gt; &amp;quot;</code>').
</li>
</ul>
<a name="example1.jshtml"></a>
<div class="program_caption">
File 'example1.jshtml':</div>
<pre class="program">&lt;table&gt;
  &lt;tbody&gt;
<strong>&lt;?js var items = ['&lt;foo&gt;', 'bar&amp;bar', '"baz"']; ?&gt;</strong>
<strong>&lt;?js for (var i = 0, n = items.length; i &lt; n; i++) { ?&gt;</strong>
<strong>&lt;?js     var item = items[i]; ?&gt;</strong>
    &lt;tr&gt;
      &lt;td&gt;<strong>#{item}</strong>&lt;/td&gt;
      &lt;td&gt;<strong>${item}</strong>&lt;/td&gt;
    &lt;/tr&gt;
<strong>&lt;?js } ?&gt;</strong>
  &lt;tbody&gt;
&lt;/table&gt;
</pre>
<p>The following is the result of executing 'example1.jshtml'.
</p>
<a name="example1.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ jstenjin example1.jshtml
&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;<strong>&lt;foo&gt;</strong>&lt;/td&gt;
      &lt;td&gt;<strong>&amp;lt;foo&amp;gt;</strong>&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;<strong>bar&amp;bar</strong>&lt;/td&gt;
      &lt;td&gt;<strong>bar&amp;amp;bar</strong>&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;<strong>"baz"</strong>&lt;/td&gt;
      &lt;td&gt;<strong>&amp;quot;baz&amp;quot;</strong>&lt;/td&gt;
    &lt;/tr&gt;
  &lt;tbody&gt;
&lt;/table&gt;
</pre>
<br>


<a name="des-convert"></a>
<h3 class="section2">Convert into JavaScript Code</h3>
<p>Command-line option '-s' converts embedded files into JavaScript code.
</p>
<a name="example1_source.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ jstenjin <strong>-s</strong> example1.jshtml
var _buf = [];  _buf.push('&lt;table&gt;\n\
  &lt;tbody&gt;\n');
 <strong>var items = ['&lt;foo&gt;', 'bar&amp;bar', '"baz"'];</strong>
 <strong>for (var i = 0, n = items.length; i &lt; n; i++) {</strong>
     <strong>var item = items[i];</strong>
 _buf.push('    &lt;tr&gt;\n\
      &lt;td&gt;', item, '&lt;/td&gt;\n\
      &lt;td&gt;', escapeXml(item), '&lt;/td&gt;\n\
    &lt;/tr&gt;\n');
 <strong>}</strong>
 _buf.push('  &lt;tbody&gt;\n\
&lt;/table&gt;\n');
_buf.join('')
</pre>
<ul type="disc">
<li>Variable <code>_buf</code> is a array.
</li>
<li>Function <code>escapeXml()</code> (= <code>Tenjin.escapeXml()</code>) escapes <code>'&amp; &lt; &gt; "'</code> into <code>'&amp;amp; &amp;lt; &amp;gt; &amp;quot;'</code>.
  Command-line option <code>--escapefunc=func</code> makes jstenjin to use <code>func()</code> instead of <code>escape()</code>.
</li>
<li>Newline character ("\n" or "\r\n") is automatically detected by jsTenjin.
</li>
</ul>
<p>'<code>_buf = [];</code>' is called as preamble and '<code>_buf.join('')</code>' is called as postamble.
Command-line option '<code>-b</code>' removes preamble and postamble.
</p>
<a name="example2.jshtml"></a>
<div class="program_caption">
File 'example2.jshtml'</div>
<pre class="program">&lt;?js var list = [1, 2, 3]; ?&gt;
&lt;?js for (var i = 0, n = list.length; i &lt; n; i++) { ?&gt;
&lt;p&gt;#{list[i]}&lt;/p&gt;
&lt;?js } ?&gt;
</pre>
<a name="example2_sb.result2"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ jstenjin -s example2.jshtml
<strong>var _buf = [];</strong>  var list = [1, 2, 3];
 for (var i = 0, n = list.length; i &lt; n; i++) {
 _buf.push('&lt;p&gt;', list[i], '&lt;/p&gt;\n');
 }
<strong>_buf.join('')</strong>
$ jstenjin -s<strong>b</strong> example2.jshtml
 var list = [1, 2, 3];
 for (var i = 0, n = list.length; i &lt; n; i++) {
 _buf.push('&lt;p&gt;', list[i], '&lt;/p&gt;\n');
 }
</pre>
<p>Command-line option '-S' also show converted JavaScript code but it doesn't print text part.
This is useful to check JavaScript code for debugging.
</p>
<a name="example1_S.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ jstenjin <strong>-S</strong> example1.jshtml
var _buf = []; 

 var items = ['&lt;foo&gt;', 'bar&amp;bar', '"baz"'];
 for (var i = 0, n = items.length; i &lt; n; i++) {
     var item = items[i];

           _buf.push(item);
           _buf.push(escapeXml(item));

 }


_buf.join('')
</pre>
<p>In addition, the following command-line options are available.
</p>
<dl class="dl3" compact>
<dt class="dt3"><b>
-N </b></dt>
<dd class="dd3">
	     Add line number.
</dd>
<dt class="dt3"><b>
-X </b></dt>
<dd class="dd3">
	     Delete expressions.
</dd>
<dt class="dt3"><b>
-C </b></dt>
<dd class="dd3">
	     Remove empty lines (compact-mode).
</dd>
<dt class="dt3"><b>
-U </b></dt>
<dd class="dd3">
	     Compress empty lines to a line (uniq-mode).
</dd>
</dl>
<a name="example1_SXNC.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ jstenjin <strong>-SUNX</strong> example1.jshtml
    1:  var _buf = []; 

    3:   var items = ['&lt;foo&gt;', 'bar&amp;bar', '"baz"'];
    4:   for (var i = 0, n = items.length; i &lt; n; i++) {
    5:       var item = items[i];

   10:   }

   13:  _buf.join('')
</pre>
<br>


<a name="des-syntaxchk"></a>
<h3 class="section2">Syntax Checking</h3>
<p>Command-line option '<code>-z</code>' checks syntax error in embedded JavaScript code.
</p>
<a name="example3.jshtml"></a>
<div class="program_caption">
File example3.jshtml:</div>
<pre class="program">&lt;ul&gt;
&lt;?js for (var i = 0; i &lt; items.length; i++) { ?&gt;
  &lt;li&gt;${items[i]}&lt;/li&gt;
&lt;?js <strong>//}</strong> ?&gt;
&lt;/ul&gt;
</pre>
<a name="example3_syntaxcheck.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ jstenjin <strong>-z</strong> example3.jshtml
[NG] example3.jshtml
example3.jshtml:7: SyntaxError: missing } in compound statement
</pre>
<p><code>js -sC</code> or <code>java -jar js.jar -strict</code> may reports more details about syntax error.
It is useful to try '<code>jstenjin -s file.jshtml | js -sC</code>'.
</p>
<br>


<a name="des-contextdata"></a>
<h3 class="section2">Context Data File</h3>
<p>jsTenjin allows you to specify context data by JSON file.
</p>
<a name="example4.jshtml"></a>
<div class="program_caption">
File 'example4.jshtml':</div>
<pre class="program">&lt;p&gt;
  ${text}
  #{num}
  #{flag}
&lt;/p&gt;

&lt;?js for (var i = 0, n = items.length; i &lt; n; i++) { ?&gt;
&lt;p&gt;${items[i]}&lt;/p&gt;
&lt;?js } ?&gt;

&lt;?js for (var key in hash) { ?&gt;
&lt;p&gt;#{key} = ${hash[key]}&lt;/p&gt;
&lt;?js } ?&gt;
</pre>
<a name="datafile.js"></a>
<div class="program_caption">
File 'datafile.js':</div>
<pre class="program">{
  text  :  "foo",
  num   :  3.14,
  flag  :  true,
  items :  ["foo", "bar", "baz"],
  hash  :  { x:1, y:2 }
}
</pre>
<a name="example4_datafile_js.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ jstenjin <strong>-f datafile.js</strong> example4.jshtml
&lt;p&gt;
  foo
  3.14
  true
&lt;/p&gt;

&lt;p&gt;foo&lt;/p&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;p&gt;baz&lt;/p&gt;

&lt;p&gt;x = 1&lt;/p&gt;
&lt;p&gt;y = 2&lt;/p&gt;
</pre>
<br>


<a name="des-cmlinecontext"></a>
<h3 class="section2">Command-line Context Data</h3>
<p>Command-line option '<code>-z</code>' specifies context data in JSON format.
</p>
<a name="example5.jshtml"></a>
<div class="program_caption">
File 'example5.jshtml':</div>
<pre class="program">text:  #{text}
items:
&lt;?js for (var i = 0, n = items.length; i &lt; n; i++) { ?&gt;
  - #{items[i]}
&lt;?js } ?&gt;
hash:
&lt;?js for (var key in hash) { ?&gt;
  #{key}: #{hash[key]}
&lt;?js } ?&gt;
</pre>
<p>'<code>{</code>' at start and '<code>}</code>' at end are omittable.
</p>
<a name="example5_datastr_js.result"></a>
<div class="terminal_caption">
Result of context data in js code:</div>
<pre class="terminal">$ jstenjin <strong>-c 'text:"foo", items:["a","b","c"], hash:{x:1,y:2}'</strong> example5.jshtml
text:  foo
items:
  - a
  - b
  - c
hash:
  x: 1
  y: 2
</pre>
<br>


<a name="des-nested-template"></a>
<h3 class="section2">Nested Template</h3>
<p>Template can include other templates.
Included templates can also include other templates.
</p>
<p>The following function is available to include other templates.
</p>
<dl class="dl3">
<dt class="dt3"><b>
include(template_name) </b></dt>
<dd class="dd3">
    Include other template.
</dd>
</dl>
<a name="example6.jshtml"></a>
<div class="program_caption">
File 'example6.jshtml':</div>
<pre class="program">&lt;html&gt;
  &lt;body&gt;

    &lt;div id="sidemenu"&gt;
<strong>&lt;?js include('sidemenu.jshtml'); ?&gt;</strong>
    &lt;/div&gt;

    &lt;div id="main-content"&gt;
&lt;?js for (var i = 0, n = items.length; i &lt; n; i++) { ?&gt;
      &lt;p&gt;${items[i]}&lt;/p&gt;
&lt;?js } ?&gt;
    &lt;/div&gt;

    &lt;div id="footer"&gt;
<strong>&lt;?js include('footer.jshtml'); ?&gt;</strong>
    &lt;/div&gt;

  &lt;/body&gt;
&lt;/table&gt;
</pre>
<a name="sidemenu.jshtml"></a>
<div class="program_caption">
File 'sidemenu.jshtml':</div>
<pre class="program">&lt;ul&gt;
&lt;?js for (var i = 0, n = menu.length; i &lt; n; i++) { ?&gt;
  &lt;li&gt;&lt;a href="${menu[i].url}"&gt;${menu[i].name}&lt;/a&gt;&lt;/li&gt;
&lt;?js } ?&gt;
&lt;/ul&gt;
</pre>
<a name="footer.jshtml"></a>
<div class="program_caption">
File 'footer.jshtml':</div>
<pre class="program">&lt;hr /&gt;
&lt;address&gt;
  &lt;a href="mailto:${webmaster_email}"&gt;${webmaster_email}&lt;/a&gt;
&lt;/address&gt;
</pre>
<a name="contextdata.js"></a>
<div class="program_caption">
File 'contextdata.js':</div>
<pre class="program">{
    items: [ '&lt;FOO&gt;', '&amp;BAR', '"BAZ"' ],
    webmaster_email: 'webmaster@example.com',
    menu: [
        { name: 'Top',      url: '/' },
        { name: 'Products', url: '/prod' },
        { name: 'Support',  url: '/support' },
    ]
}
</pre>
<a name="example6_nested.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ jstenjin -f contextdata.js example6.jshtml
&lt;html&gt;
  &lt;body&gt;

    &lt;div id="sidemenu"&gt;
<strong>&lt;ul&gt;</strong>
  <strong>&lt;li&gt;&lt;a href="/"&gt;Top&lt;/a&gt;&lt;/li&gt;</strong>
  <strong>&lt;li&gt;&lt;a href="/prod"&gt;Products&lt;/a&gt;&lt;/li&gt;</strong>
  <strong>&lt;li&gt;&lt;a href="/support"&gt;Support&lt;/a&gt;&lt;/li&gt;</strong>
<strong>&lt;/ul&gt;</strong>
    &lt;/div&gt;

    &lt;div id="main-content"&gt;
      &lt;p&gt;&amp;lt;FOO&amp;gt;&lt;/p&gt;
      &lt;p&gt;&amp;amp;BAR&lt;/p&gt;
      &lt;p&gt;&amp;quot;BAZ&amp;quot;&lt;/p&gt;
    &lt;/div&gt;

    &lt;div id="footer"&gt;
<strong>&lt;hr /&gt;</strong>
<strong>&lt;address&gt;</strong>
<strong>  &lt;a href="mailto:webmaster@example.com"&gt;webmaster@example.com&lt;/a&gt;</strong>
<strong>&lt;/address&gt;</strong>
    &lt;/div&gt;

  &lt;/body&gt;
&lt;/table&gt;
</pre>
<p>'<code>include()</code>' can take template filename
(ex. 'user_main.jshtml') or template short name (ex. ':main').
Template short name represents a template in short notation. It starts with colon (':').
</p>
<p>To make template short name available, command-line option '<code>--prefix</code>' and
'<code>--postfix</code>' are required.
For example, '<code>include("user_main.jshtml")</code>' can be described as '<code>include(":main")</code>'
when '<code>--prefix="user_"</code>' and '<code>--postfix=".jshtml"</code>' are specified in command-line.
</p>
<br>


<a name="des-layout"></a>
<h3 class="section2">Layout Template</h3>
<p>Command-line option '<code>--layout=templatename</code>' specifies layout template name.
</p>
<p>For example, 'exmample6.jshtml' template in the previous section can be divided
into layout file 'layout6.jshtml' and content file 'content6.jshtml'.
Variable '<code>_content</code>' in layout template represents the result of content file.
</p>
<a name="layout6.jshtml"></a>
<div class="program_caption">
File 'layout6.jshtml':</div>
<pre class="program">&lt;html&gt;
  &lt;body&gt;

    &lt;div id="sidemenu"&gt;
&lt;?js include('sidemenu.jshtml'); ?&gt;
    &lt;/div&gt;

    &lt;div id="main-content"&gt;
<strong>#{_content}</strong>
    &lt;/div&gt;

    &lt;div id="footer"&gt;
&lt;?js include('footer.jshtml'); ?&gt;
    &lt;/div&gt;

  &lt;/body&gt;
&lt;/table&gt;
</pre>
<a name="content6.jshtml"></a>
<div class="program_caption">
File 'content6.jshtml':</div>
<pre class="program">&lt;?js for (var i = 0, n = items.length; i &lt; n; i++) { ?&gt;
  &lt;p&gt;${items[i]}&lt;/p&gt;
&lt;?js } ?&gt;
</pre>
<a name="example6_layout.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ jstenjin -f contextdata.js <strong>--layout=layout6.jshtml</strong> content6.jshtml
&lt;html&gt;
  &lt;body&gt;

    &lt;div id="sidemenu"&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href="/"&gt;Top&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/prod"&gt;Products&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/support"&gt;Support&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
    &lt;/div&gt;

    &lt;div id="main-content"&gt;
<strong>  &lt;p&gt;&amp;lt;FOO&amp;gt;&lt;/p&gt;</strong>
<strong>  &lt;p&gt;&amp;amp;BAR&lt;/p&gt;</strong>
<strong>  &lt;p&gt;&amp;quot;BAZ&amp;quot;&lt;/p&gt;</strong>

    &lt;/div&gt;

    &lt;div id="footer"&gt;
&lt;hr /&gt;
&lt;address&gt;
  &lt;a href="mailto:webmaster@example.com"&gt;webmaster@example.com&lt;/a&gt;
&lt;/address&gt;
    &lt;/div&gt;

  &lt;/body&gt;
&lt;/table&gt;
</pre>
<p>Target template and layout template don't share local variables.
It means that local variables set in a template are not available in layout template.
</p>
<p>If you want variables set in a temlate to be available in layout template,
you should use '_context' dict.
</p>
<a name="layout7.jshtml"></a>
<div class="program_caption">
File 'layout7.jshtml':</div>
<pre class="program">...
&lt;h1&gt;<strong>${title}</strong>&lt;/h1&gt;

&lt;div id="main-content"&gt;
#{_content}
&lt;div&gt;

&lt;a href="<strong>${url}</strong>"&gt;Next page&lt;/a&gt;
...
</pre>
<a name="content7.jshtml"></a>
<div class="program_caption">
File 'content7.jshtml':</div>
<pre class="program"><strong>&lt;?js _context.title = 'Document Title'; ?&gt;</strong>
<strong>&lt;?js _context.url = '/next/page'; ?&gt;</strong>
&lt;table&gt;
  ...content...
&lt;/table&gt;
</pre>
<a name="example7_layout2.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ jstenjin --layout=layout7.jshtml content7.jshtml
...
&lt;h1&gt;<strong>Document Title</strong>&lt;/h1&gt;

&lt;div id="main-content"&gt;
&lt;table&gt;
  ...content...
&lt;/table&gt;

&lt;div&gt;

&lt;a href="<strong>/next/page</strong>"&gt;Next page&lt;/a&gt;
...
</pre>
<p>Using '_context._layout', it is able to specify layout template name in each template file.
If you assigned false to '_context._layout', no layout template is used.
</p>
<a name="content8.jshtml"></a>
<div class="program_caption">
File 'content8.jshtml':</div>
<pre class="program"><strong>&lt;?js _context._layout = ':layout8_xhtml'; ?&gt;</strong>
&lt;h1&gt;Hello World!&lt;/h1&gt;
</pre>
<a name="layout8_html.jshtml"></a>
<div class="program_caption">
File 'layout8_html.jshtml':</div>
<pre class="program">&lt;html&gt;
  &lt;body&gt;
#{_content}
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<a name="layout8_xhtml.jshtml"></a>
<div class="program_caption">
File 'layout8_xhtml.jshtml':</div>
<pre class="program">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"&gt;
  &lt;body&gt;
#{_content}
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<a name="example8_layout3.result"></a>
<div class="terminal_caption">
Result: ':layout8_html' is specified in command-line option but ':layout8_xhtml' is used</div>
<pre class="terminal">$ jstenjin --postfix='.jshtml' <strong>--layout=':layout8_html'</strong> content8.jshtml
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"&gt;
  &lt;body&gt;
&lt;h1&gt;Hello World!&lt;/h1&gt;

  &lt;/body&gt;
&lt;/html&gt;
</pre>
<br>


<a name="des-capturing"></a>
<h3 class="section2">Capturing</h3>
<p>It is able to capture any part of template.
</p>
<a name="example9.jshtml"></a>
<div class="program_caption">
File 'example9.jshtml':</div>
<pre class="program">&lt;?js _context['title'] = 'Capture Test'; ?&gt;
&lt;html&gt;
  &lt;body&gt;

<strong>&lt;?js startCapture('content_part'); ?&gt;</strong>
    &lt;ul&gt;
&lt;?js for (var i = 0; i &lt;= 2; i++) { ?&gt;
      &lt;li&gt;i = #{i}&lt;/li&gt;
&lt;?js } ?&gt;
    &lt;/ul&gt;
<strong>&lt;?js stopCapture() ?&gt;</strong>

<strong>&lt;?js startCapture('footer_part'); ?&gt;</strong>
    &lt;div class="footer"&gt;copyright&amp;copy; 2007 kuwata-lab.com&lt;/div&gt;
<strong>&lt;?js stopCapture(); ?&gt;</strong>

  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>Captured strings are accessable as local variables.
For example, you can get captured string as a variable '<code>content_part</code>' in the above example.
</p>
<p>A template can contain several capturing.
It is not able to nest capturing.
</p>
<p>In layout file, it is able to use strings captured in templates.
</p>
<a name="layout9.jshtml"></a>
<div class="program_caption">
File 'layout9.jshtml':</div>
<pre class="program">&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;title&gt;${title}&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;!-- HEADER --&gt;
<strong>&lt;?js startPlaceholder('header_part'); ?&gt;</strong>
    &lt;h1&gt;${title}&lt;/h1&gt;
<strong>&lt;?js stopPlaceholder(); ?&gt;</strong>
    &lt;!-- /HEADER --&gt;

    &lt;!-- CONTENT --&gt;
<strong>#{content_part}</strong>
    &lt;!-- /CONTENT --&gt;

    &lt;!-- FOOTER --&gt;
<strong>&lt;?js startPlaceholder('footer_part'); ?&gt;</strong>
    &lt;hr /&gt;
    &lt;address&gt;webmaster@localhost&lt;/address&gt;
<strong>&lt;?js stopPlaceholder(); ?&gt;</strong>
    &lt;!-- /FOOTER --&gt;

  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>'<code>startPlaceholder("name") ... stopPlaceholder()</code>' is quivarent to the following.
</p>
<pre class="program"><strong>&lt;?js if (_context['name']) { ?&gt;</strong>
#{_context['name']}
<strong>&lt;?js } else { ?&gt;</strong>
    ...
<strong>&lt;?js } ?&gt;</strong>
</pre>
<p>The following result shows that content part and footer part are overrided by capturing in content template but header part is not.
</p>
<a name="example9_capture.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ jstenjin --layout=layout9.jshtml example9.jshtml
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;title&gt;Capture Test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;!-- HEADER --&gt;
    &lt;h1&gt;Capture Test&lt;/h1&gt;
    &lt;!-- /HEADER --&gt;

    &lt;!-- CONTENT --&gt;
    <strong>&lt;ul&gt;</strong>
      <strong>&lt;li&gt;i = 0&lt;/li&gt;</strong>
      <strong>&lt;li&gt;i = 1&lt;/li&gt;</strong>
      <strong>&lt;li&gt;i = 2&lt;/li&gt;</strong>
    <strong>&lt;/ul&gt;</strong>

    &lt;!-- /CONTENT --&gt;

    &lt;!-- FOOTER --&gt;
    <strong>&lt;div class="footer"&gt;copyright&amp;copy; 2007 kuwata-lab.com&lt;/div&gt;</strong>
    &lt;!-- /FOOTER --&gt;

  &lt;/body&gt;
&lt;/html&gt;
</pre>
<br>


<a name="des-args"></a>
<h3 class="section2">Template Arguments</h3>
<p>It is able to specify template arguments in template files.
Template arguments are variables which are passed by main program via context object.
In the following example, '<code>title</code>' and '<code>name</code>' are template arguments.
</p>
<a name="example10.jshtml"></a>
<div class="program_caption">
File 'example10.jshtml':</div>
<pre class="program">&lt;?xml version="1.0"?&gt;
<strong>&lt;?js //@ARGS title, name ?&gt;</strong>
&lt;h1&gt;${title}&lt;/h1&gt;
&lt;p&gt;Hello ${name}!&lt;/p&gt;
</pre>
<p>Template arguments line is converted into assignment statements of local variables.
</p>
<a name="example10_template_args.result"></a>
<pre class="terminal">$ jstenjin -s example10.jshtml
var _buf = [];  _buf.push('&lt;?xml version="1.0"?&gt;\n');
<strong> var title = _context['title']; var name = _context['name'];</strong>
 _buf.push('&lt;h1&gt;', escapeXml(title), '&lt;/h1&gt;\n\
&lt;p&gt;Hello ', escapeXml(name), '!&lt;/p&gt;\n');
_buf.join('')
</pre>
<p>If template arguments are specified, other variables passed by context object are not set.
</p>
<a name="example11.jshtml"></a>
<div class="program_caption">
File 'example11.jshtml':</div>
<pre class="program">&lt;p&gt;
<strong>&lt;?js //@ARGS x ?&gt;</strong>
x = ${x}
y = ${y}   # error
&lt;/p&gt;
</pre>
<a name="example11_template_args_result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ jstenjin <strong>-wc 'x:10,y:20'</strong> example11.jshtml
*** ERROR:
example11.jshtml: y is not defined
</pre>
<p>Special variable '<code>_context</code>' which represents context object is always available whether template arguments are specified or not.
</p>
<br>


<a name="des-preprocess"></a>
<h3 class="section2">Preprocessing</h3>
<p>jsTenjin supports preprocessing of template.
Preprocessing executes some logics when templates are loaded and that logics are not executed when rendering.
Preprocessing makes your application much faster.
</p>
<p>Notation of preprocessing is the following.
</p>
<ul type="disc">
<li><code>&lt;?JS ... ?&gt;</code> represents preprocessing statement.
</li>
<li><code>#{{...}}</code> represents preprocessing expression (without HTML escape).
</li>
<li><code>${{...}}</code> represents preprocessing expression (with HTML escape).
</li>
</ul>
<p>For example, assume the following template.
</p>
<a name="example12.jshtml"></a>
<div class="program_caption">
File 'example12.jshtml':</div>
<pre class="program"><strong>&lt;?JS var states = { CA: "California", ?&gt;</strong>
<strong>&lt;?JS                NY: "New York", ?&gt;</strong>
<strong>&lt;?JS                FL: "Florida",  ?&gt;</strong>
<strong>&lt;?JS                TX: "Texas",  ?&gt;</strong>
<strong>&lt;?JS                HI: "Hawaii" }; ?&gt;</strong>
&lt;?js var chk = {};  chk[params.state] = ' selected="selected"'; ?&gt;
<strong>&lt;?JS var codes = []; ?&gt;</strong>
<strong>&lt;?JS for (var code in states) { codes.push(code); } ?&gt;</strong>
<strong>&lt;?JS codes.sort(); ?&gt;</strong>
&lt;select name="state"&gt;
  &lt;option value=""&gt;-&lt;/option&gt;
<strong>&lt;?JS for (var i = 0, n = codes.length; i &lt; n; i++) { ?&gt;</strong>
<strong>&lt;?JS     var code = codes[i]; ?&gt;</strong>
  &lt;option value="<strong>#{{code}}</strong>"#{chk.<strong>#{{code}}</strong>||''}&gt;<strong>${{states[code]}}</strong>&lt;/option&gt;
<strong>&lt;?JS } ?&gt;</strong>
&lt;/select&gt;
</pre>
<p>If preprocessing is activated, the above will be converted into the following when template is loaded.
(Command-line option <code>-P</code> shows the result of preprocessing.)
</p>
<a name="example12_preprocessed.result"></a>
<div class="terminal_caption">
Result of preprocessing:</div>
<pre class="terminal">$ jstenjin <strong>-P</strong> example12.jshtml
&lt;?js var chk = {};  chk[params.state] = ' selected="selected"'; ?&gt;
&lt;select name="state"&gt;
  &lt;option value=""&gt;-&lt;/option&gt;
  &lt;option value="CA"#{chk.CA||''}&gt;California&lt;/option&gt;
  &lt;option value="FL"#{chk.FL||''}&gt;Florida&lt;/option&gt;
  &lt;option value="HI"#{chk.HI||''}&gt;Hawaii&lt;/option&gt;
  &lt;option value="NY"#{chk.NY||''}&gt;New York&lt;/option&gt;
  &lt;option value="TX"#{chk.TX||''}&gt;Texas&lt;/option&gt;
&lt;/select&gt;
</pre>
<p>This means that for-loop is executed only once when template is loaded and is not executed when rendering.
In the result, rendering speed becomes to be much faster.
</p>
<p>And the JavaScript code is here. This shows that there is no for-loop.
</p>
<a name="example12_preprocessed_source.result"></a>
<div class="terminal_caption">
Translated script code:</div>
<pre class="terminal">$ jstenjin <strong>--preprocess</strong> -sb example12.jshtml
 var chk = {};  chk[params.state] = ' selected="selected"';
 _buf.push('&lt;select name="state"&gt;\n\
  &lt;option value=""&gt;-&lt;/option&gt;\n\
  &lt;option value="CA"', chk.CA||'', '&gt;California&lt;/option&gt;\n\
  &lt;option value="FL"', chk.FL||'', '&gt;Florida&lt;/option&gt;\n\
  &lt;option value="HI"', chk.HI||'', '&gt;Hawaii&lt;/option&gt;\n\
  &lt;option value="NY"', chk.NY||'', '&gt;New York&lt;/option&gt;\n\
  &lt;option value="TX"', chk.TX||'', '&gt;Texas&lt;/option&gt;\n\
&lt;/select&gt;\n');
</pre>
<p>If you have errors on preprocessing, you should check source script by <code>-Ps</code> option<sup>(<a href="#fnref:1" name="fnlink:1">*1</a>)</sup>.
</p>
<p>The following is an another example.
Assume that <code>link_to()</code> is a helper method which takes label and url and generate
<code>&lt;a&gt;&lt;/a&gt;</code> tag.
In this case, label and url can be parameterized by <code>_p("...")</code> and <code>_P("...")</code>.
The former is converted into <code>#{...}</code> and the latter converted into <code>${...}</code>
by preprocessor.
</p>
<a name="example13.jshtml"></a>
<div class="program_caption">
File 'example13.jshtml':</div>
<pre class="program">&lt;?JS // ex. link_to('Show', '/show/1')  =&gt; &lt;a href="/show/1"&gt;Show&lt;/a&gt; ?&gt;
&lt;?JS function link_to(label, url) { ?&gt;
&lt;?JS     return '&lt;a href="' + escape(url) + '"&gt;' + label + '&lt;/a&gt;'; ?&gt;
&lt;?JS } ?&gt;
#{{link_to('Show '+<strong>_P('params["name"]')</strong>, '/items/show/'+<strong>_p('params["id"]')</strong>)}}
</pre>
<a name="example13_preprocessed.result"></a>
<div class="terminal_caption">
Preprocessed template:</div>
<pre class="terminal">$ jstenjin <strong>-P</strong> example13.jshtml
&lt;a href="/items/show/<strong>#{params["id"]}"</strong>&gt;Show <strong>${params["name"]}</strong>&lt;/a&gt;
</pre>
<a name="example13_preprocessed_source.result"></a>
<div class="terminal_caption">
Translated script code:</div>
<pre class="terminal">$ jstenjin <strong>--preprocess</strong> -sb example13.jshtml
 _buf.push('&lt;a href="/items/show/', params["id"], '"&gt;Show ', escapeXml(params["name"]), '&lt;/a&gt;\n');
</pre>
<p>There are many web-application framework and they provides helper functions.
These helper functions are divided into two groups.
</p>
<ul type="disc">
<li><code>link_to()</code> or <code>_()</code> (function for M17N) return the same result
   when the same arguments are passed.
   These functions can be expanded by preprocessor.
</li>
<li>Some functions return the different result even if the same arguments are passed.
   These functions can't be expaned by preprocessor.
</li>
</ul>
<p>Preprocessor has the power to make your application much faster,
but it may make the debugging difficult.
You should use it carefully.
</p>
<div class="footnote">
 <dl compact>
  <dt>(<a name="fnref:1" href="#fnlink:1">*1</a>)</dt>
  <dd>Command-line option '-Ps' is available but '-PS' is not availabe. This is a current restriction of jstenjin. </dd>
 </dl>
</div>
<br>


<a name="des-otheropts"></a>
<h3 class="section2">Other Options</h3>
<ul type="disc">
<li>Command-line option '<code>--escapefunc=func1</code>' changes <code>escape()</code> function name to <code>func1</code>.
</li>
<li>Command-line option '<code>--path=dir1,dir2,...</code>' sepcifies template directory path.
</li>
<li>Rhino and SpiderMonkey are supported as JavaScript engine.
</li>
</ul>
<br>


<br>


<a name="devguide"></a>
<h2 class="section1">Developer's Guide</h2>
<p>This section shows how to use jsTenjin in your JavaScript script.
</p>
<p>If you want to know the notation or features of jsTenjin, see <a href="#desguide">Designer's Guide</a> section.
</p>
<a name="dev-example"></a>
<h3 class="section2">An Example</h3>
<p>The following is an example to use jsTenjin in JavaScript.
</p>
<div class="program_caption">
Example:</div>
<pre class="program">load('tenjin.js');
var engine = new Tenjin.Engine();
var context = { title:'jsTenjin Example', items:['AAA', 'BBB', 'CCC'] };
var filename = 'file.jshtml';
var output = engine.render(filename, context);
print(output);
</pre>
<br>


<a name="dev-classes"></a>
<h3 class="section2">Classes and Functions in jsTenjin</h3>
<p>jsTenjin has the follwoing classes.
</p>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin.Template </b></dt>
<dd class="dd3">
    This class represents a template file.
    An object of Tenjin.Template correspond to a template file.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin.Engine </b></dt>
<dd class="dd3">
    This class represents some template objects.
    It can handle nested template and layout template.
    Using Tenjin.Engine class, you can use jsTenjin as a template engine for web application.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin.Context </b></dt>
<dd class="dd3">
    This class represents context data.
</dd>
</dl>
<br>


<a name="dev-templateclass"></a>
<h3 class="section2">Class Tenjin.Template</h3>
<p>Tenjin.Template class represents a template file.
An object of Tenjin.Template corresponds to a template file.
It doesn't support nested template nor layout template (use Tenjin.Engine class instead).
</p>
<p>This class has the following methods and attributes.
</p>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin.Template(filename=undefined, properties={}) </b></dt>
<dd class="dd3">
    Create template object. If filename is given, read and convert it to JavaScript code.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin.Template.convert(input, filename=undefined) </b></dt>
<dd class="dd3">
    Convert input text into JavaScript code and return it.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin.Template.convert_file(filename) </b></dt>
<dd class="dd3">
    Convert file into JavaScript code and return it.
    This is equivarent to <code>Tenjin.Template.convert(Tenjin.readFile(filename), filename)</code>
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin.Template#render(context=undefined) </b></dt>
<dd class="dd3">
    Convert JavaScript code, evaluate it with context data, and return the result of evaluation.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin.Template.script </b></dt>
<dd class="dd3">
    Converted JavaScript code
</dd>
</dl>
<p>The followings are examples to use Tenjin.Template in JavaScript script.
</p>
<a name="example14.jshtml"></a>
<div class="program_caption">
File 'example14.jshtml':</div>
<pre class="program">&lt;h1&gt;#{title}&lt;/h1&gt;
&lt;ul&gt;
&lt;?js for (var i = 0, n = items.length; i &lt; n; i++) { ?&gt;
 &lt;li&gt;${items[i]}&lt;/li&gt;
&lt;?js } ?&gt;
&lt;/ul&gt;
</pre>
<a name="example14.js"></a>
<div class="program_caption">
File 'example14.js':</div>
<pre class="program">//// template file
var filename = 'example14.jshtml';

//// convert into js code
load('tenjin.js');
var template = <strong>new Tenjin.Template(filename)</strong>;
var script = <strong>template.script</strong>;
//// or
// var template = new Tenjin.Template();
// var script = <strong>template.convert_file(filename)</strong>;
//// or
// var template = new Tenjin.Template();
// var input = Tenjin.Util.readFile(filename);
// var script = <strong>template.convert(input, filename)</strong>;  # filename is optional

//// show converted js code
print("---- js code ----");
print(script);

//// evaluate js code
var context = {title:'jsTenjin Example', items:['&lt;AAA&gt;','B&amp;B','"CCC"']};
var output = <strong>template.render(context)</strong>;
print("---- output ----");
print(output);
</pre>
<a name="example14_tmplclass.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ js example14.js
---- js code ----
var _buf = [];  _buf.push('&lt;h1&gt;', title, '&lt;/h1&gt;\n\
&lt;ul&gt;\n');
 for (var i = 0, n = items.length; i &lt; n; i++) {
 _buf.push(' &lt;li&gt;', escapeXml(items[i]), '&lt;/li&gt;\n');
 }
 _buf.push('&lt;/ul&gt;\n');
_buf.join('')

---- output ----
&lt;h1&gt;jsTenjin Example&lt;/h1&gt;
&lt;ul&gt;
 &lt;li&gt;&amp;lt;AAA&amp;gt;&lt;/li&gt;
 &lt;li&gt;B&amp;amp;B&lt;/li&gt;
 &lt;li&gt;&amp;quot;CCC&amp;quot;&lt;/li&gt;
&lt;/ul&gt;

</pre>
<br>


<a name="dev-engineclass"></a>
<h3 class="section2">Class Tenjin.Engine</h3>
<p>Tenjin.Engine class contains some template objects.
It can handle nested template and layout template.
Using Tenjin.Engine class, you can use jsTenjin as a template engine for web application.
</p>
<p>This class has the following methods.
</p>
<dl class="dl3">
<dt class="dt3"><b>
new Tenjin.Engine(properties={prefix:'', postfix:'', layout:undefined, path:undefined, cache:false, preprocess:false, templateclass:Tenjin.Template}) </b></dt>
<dd class="dd3">
    Create Engine object.
    <code>path</code> represents template search path and it should be an Array of directory name.
    If other properties are passed then they are passed to Tenjin.Template() internally.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin.Engine.render(template_name, context=undefined, layout=null) </b></dt>
<dd class="dd3">
    Convert template into JavaScript code, evaluate it with context data, and return the result of it.
    If <code>layout</code> is true or null then layout template name specified by constructor option is
    used as layout template, else if false then layout template is not used,
    else if string then it is regarded as layout template name.
</dd>
</dl>
<p>Argument <code>template_name</code> in render() methods is filename or short name of template.
Template short name is a string starting with colon (':').
For example, '<code>render(":list", context)</code>' is equivarent to '<code>render("user_list.jshtml", context)</code>' if prefix option is '<code>user_</code>' and postfix option is '<code>.jshtml</code>'.
</p>
<p>In template file, the followings are available.
</p>
<dl class="dl3">
<dt class="dt3"><b>
_content </b></dt>
<dd class="dd3">
    This variable represents the result of evaluation of other template.
    This is available only in layout template file.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
include(template_name) </b></dt>
<dd class="dd3">
    Include other template file.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
startCapture(name) </b></dt>
<dd class="dd3">
    Start capturing. Result will be stored into <code>_context.<em>name</em></code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
stopcapture() </b></dt>
<dd class="dd3">
    Stop capturing.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
startPlaceholder(varname), stopPlaceholder() </b></dt>
<dd class="dd3">
    Placeholder is a region from startPlaceholder() to stopPlaceholder().
    If captured string as <em>varname</em> exists then use it as content,
    else use content in placeholder as is.
    For example,
<pre class="terminal">&lt;?js startPlaceholder('foo'); ?&gt;
  ...
&lt;?js stopPlaceholder(); ?&gt;
</pre>
    is equivarent to:
<pre class="terminal">&lt;?js if (typeof(_context['foo']) != 'undefined') { ?&gt;
&lt;?js     _buf.push(_contet['foo']); ?&gt;
&lt;?js } else { ?&gt;
  ...
&lt;?js } ?&gt;
</pre>
</dd>
</dl>
<p>(Notice that include(), startCapture(), stopCapture(), startPlaceholder(), and stopPlaceholder() are built-in macros
of jsTenjin and they are not function of JavaScript.)
</p>
<p>The followings are example of Tenjin.Engine class.
</p>
<a name="user_form.jshtml"></a>
<div class="program_caption">
File 'user_form.jshtml':</div>
<pre class="program">&lt;?js //@ARGS params ?&gt;
&lt;p&gt;
  Name:  &lt;input type="text" name="name"  value="${params.name}" /&gt;&lt;br /&gt;
  Email: &lt;input type="text" name="email" value="${params.email}" /&gt;&lt;br /&gt;
  Gender:
&lt;?js gender = params.gender; ?&gt;
&lt;?js chk = {}; chk[true] = ' checked="checked"'; chk[false] = ''; ?&gt;
  &lt;input type="radio" name="gender" value="m" #{chk[gender=='m']} /&gt;Male
  &lt;input type="radio" name="gender" value="f" #{chk[gender=='f']} /&gt;Female
&lt;/p&gt;
</pre>
<a name="user_create.jshtml"></a>
<div class="program_caption">
File 'user_create.jshtml':</div>
<pre class="program">&lt;?js //@ARGS ?&gt;
&lt;form action="user_app.cgi" method="post"&gt;
  &lt;input type="hidden" name="action" value="create" /&gt;
<strong>&lt;?js include(':form'); ?&gt;</strong>
  &lt;input type="submit" value="Create" /&gt;
&lt;/form&gt;
</pre>
<a name="user_edit.jshtml"></a>
<div class="program_caption">
File 'user_edit.jshtml':</div>
<pre class="program">&lt;?js //@ARGS params ?&gt;
&lt;form action="user_app.cgi" method="post"&gt;
  &lt;input type="hidden" name="action" value="edit" /&gt;
  &lt;input type="hidden" name="id" value="${params.id}" /&gt;
<strong>&lt;?js include(':form'); ?&gt;</strong>
  &lt;input type="submit" value="Edit" /&gt;
&lt;/form&gt;
</pre>
<a name="user_layout.jshtml"></a>
<div class="program_caption">
File 'user_layout.jshtml':</div>
<pre class="program">&lt;?js //@ARGS _content, title ?&gt;
&lt;html&gt;
  &lt;body&gt;

    &lt;h1&gt;${title}&lt;/h1&gt;

    &lt;div id="main-content"&gt;
<strong>#{_content}</strong>
    &lt;/div&gt;

    &lt;div id="footer"&gt;
<strong>&lt;?js include('footer.html'); ?&gt;</strong>
    &lt;/div&gt;

  &lt;/body&gt;
&lt;/html&gt;
</pre>
<a name="footer.html"></a>
<div class="program_caption">
File 'footer.html':</div>
<pre class="program">&lt;?js //@ARGS ?&gt;
&lt;hr /&gt;
&lt;address&gt;
  &lt;a href="mailto:webmaster@example.com"&gt;webmaster@example.com&lt;/a&gt;
&lt;/address&gt;
</pre>
<a name="user_app.cgi"></a>
<div class="program_caption">
File 'user_app.cgi':</div>
<pre class="program">#!/usr/bin/env js -f

<strong>load('tenjin.js');</strong>

// set action ('create' or 'edit')
var action = 'create';

// set context data
var title, params;
if (action == 'create') {
    title = 'Create User';
    params = {};
}
else {
    title = 'Edit User';
    params = {
        name: 'Margalette',
        email: 'meg@example.com',
        gender: 'f',
        id: 123
    };
}
<strong>var context = { title: title, params: params }</strong>;

// create engine object
var layout = ':layout';   // or 'user_layout.jshtml'
<strong>var engine = new Tenjin.Engine({prefix:'user_', postfix:'.jshtml', layout:layout})</strong>;

// evaluate template
var template_name = ':'+action;   // ':create' or ':edit'
<strong>var output = engine.render(template_name, context)</strong>;
print(output);
</pre>
<a name="user_app.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ js user_app.cgi create
&lt;html&gt;
  &lt;body&gt;

    &lt;h1&gt;Create User&lt;/h1&gt;

    &lt;div id="main-content"&gt;
<strong>&lt;form action="user_app.cgi" method="post"&gt;</strong>
<strong>  &lt;input type="hidden" name="action" value="create" /&gt;</strong>
<strong>&lt;p&gt;</strong>
<strong>  Name:  &lt;input type="text" name="name"  value="" /&gt;&lt;br /&gt;</strong>
<strong>  Email: &lt;input type="text" name="email" value="" /&gt;&lt;br /&gt;</strong>
<strong>  Gender:</strong>
<strong>  &lt;input type="radio" name="gender" value="m"  /&gt;Male</strong>
<strong>  &lt;input type="radio" name="gender" value="f"  /&gt;Female</strong>
<strong>&lt;/p&gt;</strong>
<strong>  &lt;input type="submit" value="Create" /&gt;</strong>
<strong>&lt;/form&gt;</strong>

    &lt;/div&gt;

    &lt;div id="footer"&gt;
<strong>&lt;hr /&gt;</strong>
<strong>&lt;address&gt;</strong>
<strong>  &lt;a href="mailto:webmaster@example.com"&gt;webmaster@example.com&lt;/a&gt;</strong>
<strong>&lt;/address&gt;</strong>
    &lt;/div&gt;

  &lt;/body&gt;
&lt;/html&gt;

</pre>
<br>


<a name="dev-initopts"></a>
<h3 class="section2">Template Initialize Options</h3>
<p>Tenjin.Template() can take the follwoing options.
</p>
<ul type="disc">
<li>'<code>escapefunc</code>' (string) specifies function name to escape string.
  Default is '<code>escapeXml</code>' (= <code>Tenjin.Util.escapeXml</code>).
</li>
</ul>
<p>Constructor of Tenjin.Engine can also take the same options as above.
These options given to constructor of Tenjin.Engine are passed to constructor of Tenjin.Template internally.
</p>
<a name="example15.js"></a>
<div class="program_caption">
File 'example15.js':</div>
<pre class="program">load('tenjin.js');
var filename = 'example14.jshtml';
var template = new Tenjin.Template(filename, <strong>{escapefunc:'.escapeHTML'}</strong>);
print(template.script);

String.prototype.escapeHTML = function() {
    return this.replace(/\&amp;/g,'&amp;amp;').replace(/&lt;/g,'&amp;lt;').replace(/&gt;/g,'&amp;gt;').replace(/"/g,'&amp;quot;');
}
var title = 'jsTenjin Example';
var items = ['&lt;foo&gt;', '&amp;bar', '"baz"'];
var output = template.render({title:title, items:items});
print(output);
</pre>
<a name="example15_escapefunc.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ js example15.js
var _buf = [];  _buf.push('&lt;h1&gt;', title, '&lt;/h1&gt;\n\
&lt;ul&gt;\n');
 for (var i = 0, n = items.length; i &lt; n; i++) {
 _buf.push(' &lt;li&gt;', <strong>(items[i]).escapeHTML()</strong>, '&lt;/li&gt;\n');
 }
 _buf.push('&lt;/ul&gt;\n');
_buf.join('')

&lt;h1&gt;jsTenjin Example&lt;/h1&gt;
&lt;ul&gt;
 &lt;li&gt;&amp;lt;foo&amp;gt;&lt;/li&gt;
 &lt;li&gt;&amp;amp;bar&lt;/li&gt;
 &lt;li&gt;&amp;quot;baz&amp;quot;&lt;/li&gt;
&lt;/ul&gt;

</pre>
<br>


<a name="dev-othertopics"></a>
<h3 class="section2">Other Topics</h3>
<ul type="disc">
<li>jsTenjin is suitable for server-side JavaScript, but it may be too large for client-side JavaScript.
   If you want to use jsTenjin in client-side, try 'shotenjin.js'.
   'shotenjin.js' is a minimum subset of jsTenjin.
<a name="example_shotenjin.js"></a>
<pre class="program">var input = '\
&lt;ul&gt;\n\
&lt;?js for (var i = 0, n = items.length; i &lt; n; i++) { ?&gt;\n\
  &lt;li&gt;${items[i]}&lt;/li&gt;\n\
&lt;?js } ?&gt;\n\
&lt;/ul&gt;\n\
';
load('shotenjin.js');
var context = {items: ['AAA','BBB','CCC']};
var output = <strong>Shotenjin.render(input, context)</strong>;
</pre>
</li>
</ul>
<ul type="disc">
<li>Tenjin.Template detects newline character ("\n" or "\r\n") automatically.
   If input file contains "\r\n", jsTenjin generates output which contains "\r\n".
</li>
</ul>
<ul type="disc">
<li>Tenjin.Template.render() can be called many times.
   If you create a Tenjin.Template object, you can call render() method many times.
</li>
</ul>
<ul type="disc">
<li>Tenjin.Template.convert() also can be called many times.
  If you create a Tenjin.Template object, you can call convert() (and also render()) method many times.
</li>
</ul>
<br>


<br>



   </div>
  </blockquote>

 </body>
</html>
